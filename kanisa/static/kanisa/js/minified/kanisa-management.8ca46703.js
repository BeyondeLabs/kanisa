function update_event_list(){$.get(update_diary_url,function(a){$("#diary_page").html(a);bind_diary_handlers()})}function quick_event_schedule(d){d.preventDefault();var c=$(this);c.hide();var a=c.siblings("span");var e=c.attr("data-event-id");var b=c.attr("data-event-date");a.html('<i class="spinner"></i>');$.post(schedule_event_url,{event:e,date:b},function(f){update_event_list()}).error(function(f){alert_failure(f.responseText);c.show();a.html("")})}function quick_event_delete(a){a.preventDefault();title=$(this).attr("data-event-title");if(confirm('Are you sure you want to cancel the event "'+title+'"?')){$.post($(this).attr("href"),function(b){update_event_list()})}}function bind_diary_handlers(){$("a.regular_schedule").click(quick_event_schedule);$("a.scheduled_event_cancel").click(quick_event_delete)}$(document).ready(function(){bind_diary_handlers();$("#schedule-weeks-events").mouseover(function(){$(".noautoschedule").fadeTo("fast",0.3)}).mouseout(function(){$(".noautoschedule").fadeTo("fast",1)})});$(document).ready(function(){var c=$(".thumbnailfileinput").parent();var b=c.find("input[type=checkbox]");var a=c.find("label");b.css("vertical-align","top").css("margin-top","10px");a.css("vertical-align","top").css("display","inline-block").css("margin-top","6px")});function update_page_list(){$.get(pages_list_url,function(b){$("#page_details_container").html(b.page_table);bind_delete_handlers();var a=$("#id_parent");var c=a.val();a.html(b.options);a.val(c)},"json")}function quick_page_create(d){d.preventDefault();var c=$(this);if(c.data("submitting")==true){return false}c.data("submitting",true);var b=c.find("#id_title");var f=c.find("#id_parent");var e=b.val();var a=c.find("div");a.html('<i class="spinner"></i>');$.post(page_create_url,{title:e,parent:f.val()},function(g){a.html('<i class="icon-ok"></i> '+g);b.val("");update_page_list()}).error(function(g){a.html('<i class="icon-exclamation-sign"></i> '+g.responseText)}).complete(function(){c.data("submitting",false)})}function quick_page_delete(a){a.preventDefault();page=$(this).attr("data-page-title");if(confirm('Are you sure you want to delete the page "'+page+'"?')){$.post($(this).attr("href"),function(b){update_page_list()})}}function bind_delete_handlers(){$("a.page_delete").click(quick_page_delete)}$(document).ready(function(){$("#page_quick_create").submit(quick_page_create);bind_delete_handlers()});function quick_series_complete(d){d.preventDefault();var c=$(this);c.hide();var b=c.attr("data-series-id");var a=c.siblings("span");a.html('<i class="spinner"></i>');$.post(series_complete_url,{series:b},function(e){c.remove();a.html('<i class="icon-ok"></i> '+e);a.delay(3000).fadeOut(1000)}).error(function(e){alert_failure(e.responseText);c.show();a.html("")})}$(document).ready(function(){$("a.series_complete").click(quick_series_complete)});function on_band_change(c){var b=$(this).val();if($(this).val().length==0){$("#id_band_leader").val("");$("#id_musicians").val([]);return}var a=$(this).parents("form").attr("data-band-info-url");$.get(a,{band_id:b},function(d){$("#id_band_leader").val(d.band_leader);$("#id_musicians").val(d.musicians);$("#id_musicians").trigger("chosen:updated")},"json")}function on_date_change_evt(c){var b=$(this);var d=$("#id_date_warning");if(d.length==0){$(this).after('<div id="id_date_warning" class="help-inline"></div>')}var a=$(this).parents("form").attr("data-event-info-url");$.get(a,{date:b.val()},function(j){var g=$("#id_event");var h=$("#id_date_warning");h.parents(".control-group").addClass("error");var e="";if(j.events.length==0){h.html("<strong>There are no events on that date.</strong>");g.html("");g.parent().parent().hide();return}h.html("");h.parents(".control-group").removeClass("error");g.parents(".control-group").removeClass("error");g.siblings("span").remove();for(var f=0;f<j.events.length;f++){e+='<option value="'+j.events[f][0]+'">'+j.events[f][1]+"</option>"}g.html(e);g.parent().parent().show()},"json")}$(document).ready(function(){$(".serviceform #id_band").change(on_band_change);$(".serviceform #id_date").change(on_date_change_evt);$(".serviceform #div_id_event").hide()});function navigation_move(e,d,b){e.preventDefault();var f=d.attr("data-navigation-id");var c=d.parent();var a=c.html();d.parent().html('<i class="spinner"></i>');$.post(b,{navigation_element:f},function(g){update_navigation_list()}).error(function(g){alert_failure(g.responseText);c.html(a)})}function navigation_move_up(a){navigation_move(a,$(this),navigation_up_url)}function navigation_move_down(a){navigation_move(a,$(this),navigation_down_url)}function bind_move_handlers(){$("a.move_up").click(navigation_move_up);$("a.move_down").click(navigation_move_down)}function update_navigation_list(){$.get(list_navigation_url,function(a){$("#navigation_details_container").html(a);bind_move_handlers()})}function quick_navigation_delete(a){a.preventDefault();var b=$(this).attr("data-navigation-title");if(confirm('Are you sure you want to delete the navigation element "'+b+'"?')){$.post($(this).attr("href"),function(c){update_navigation_list()})}}function bind_delete_handlers(){$("a.navigation_delete").click(quick_navigation_delete)}$(document).ready(function(){bind_move_handlers();bind_delete_handlers()});$(document).ready(function(){$(".biblepassagewidget").focusout(function(){var d=$(this);var b=d.val();if(d.siblings(".biblepassageresponse").length==0){d.after('<span class="biblepassageresponse"></span>')}var a=d.siblings(".biblepassageresponse");if(b.length==0){a.html("");return}var c=d.attr("data-validate-url");if(c===undefined){a.html('<i class="icon-exclamation-sign"></i> Could not locate Bible passage checker.');return}$.post(c,{passage:b},function(e){a.html('<i class="icon-ok"></i> '+e)}).error(function(e){a.html('<i class="icon-exclamation-sign"></i> '+e.responseText)})})});jQuery.fn.extend({insertAtCaret:function(a){return this.each(function(d){if(document.selection){this.focus();var e=document.selection.createRange();e.text=a;this.focus()}else{if(this.selectionStart||this.selectionStart=="0"){var c=this.selectionStart;var b=this.selectionEnd;var f=this.scrollTop;this.value=this.value.substring(0,c)+a+this.value.substring(b,this.value.length);this.focus();this.selectionStart=c+a.length;this.selectionEnd=c+a.length;this.scrollTop=f}else{this.value+=a;this.focus()}}})}});function get_container(a){return $(a.parents("div.main_input_widget_container")[0])}function get_matching_elements(b,a){return get_container(b).find(a)}function show_spinner(a){get_matching_elements(a,".spinner_placeholder").show()}function hide_spinner(a){get_matching_elements(a,".spinner_placeholder").hide()}function get_placeholder(a){return get_matching_elements(a,".selection_placeholder")}function get_cancel(a){return get_matching_elements(a,".main_input_widget_cancel")}function clear_placeholder(c){c.preventDefault();var a=$(this);a.hide();var b=get_matching_elements(a,".main_input_widget_action");b.show();var d=get_placeholder(a);d.html("");on_popup_close=function(){}}function hide_alignment(a){get_matching_elements(a,".alignment").hide()}function show_alignment(a){get_matching_elements(a,".alignment").show()}function get_size(a){return get_matching_elements(a,"input[name=size]:checked").attr("value")}function get_alignment(a){return get_matching_elements(a,"input[name=alignment]:checked").attr("value")}function change_size(c){var a=$(this);var b=get_size(a);if(b=="headline"){hide_alignment(a);get_matching_elements(a,".thumbnail-small").hide();get_matching_elements(a,".thumbnail-medium").hide();get_matching_elements(a,".thumbnail-headline").show()}else{if(b=="medium"){show_alignment(a);get_matching_elements(a,".thumbnail-small").hide();get_matching_elements(a,".thumbnail-medium").show();get_matching_elements(a,".thumbnail-headline").hide()}else{show_alignment(a);get_matching_elements(a,".thumbnail-small").show();get_matching_elements(a,".thumbnail-medium").hide();get_matching_elements(a,".thumbnail-headline").hide()}}}function get_code(c){var a=get_matching_elements(c,".main_input_widget_image_choice").attr("data-img-slug");var b=get_size(c);var d="!["+a+" "+b;if(b!="headline"){d+=" "+get_alignment(c)}d+="]";return d}function update_code_preview(a){get_matching_elements(a,".image-code").html(get_code(a))}function on_image_attribute_change(a){update_code_preview($(this))}function insert_image(b){b.preventDefault(b);var a=$(this);get_matching_elements(a,"textarea").insertAtCaret(get_code(a));get_cancel(a).click()}function select_image(b){b.preventDefault(b);var a=$(this);var c=get_placeholder(a);show_spinner(c);$.get(a.attr("data-select-url"),function(d){c.html(d);get_matching_elements(c,"input[name=size]").click(change_size);get_matching_elements(c,".main_input_widget_image_insert").click(insert_image);get_matching_elements(c,".main_input_widget_get_images").click(get_images);update_code_preview(c);get_matching_elements(c,"input[type=radio]").click(on_image_attribute_change);hide_spinner(c)})}function paginate_images(c){c.preventDefault();var a=$(this);var b=a.attr("href");var d=get_placeholder(a);refresh_images(d,b)}function refresh_images(b,a){show_spinner(b);$.get(a,function(c){get_cancel(b).show();b.html(c);get_matching_elements(b,".main_input_widget_image_choice").click(select_image);hide_spinner(b);get_matching_elements(b,".main_input_widget_image_paginate").click(paginate_images)})}function get_images(c){c.preventDefault();var a=$(this);get_matching_elements(a,".main_input_widget_action").hide();var d=get_placeholder(a);var b=a.attr("data-url");refresh_images(d,b);on_popup_close=function(){refresh_images(d,b)}}function insert_attachment(d){d.preventDefault();var b=$(this);var a=b.attr("data-slug");var c="{@"+a+"}";get_matching_elements(b,"textarea").insertAtCaret(c);get_cancel(b).click()}function refresh_attachments(b,a){show_spinner(b);$.get(a,function(c){get_cancel(b).show();b.html(c);get_matching_elements(b,".media-documents a").click(insert_attachment);hide_spinner(b)})}function get_attachments(c){c.preventDefault();var a=$(this);get_matching_elements(a,".main_input_widget_action").hide();var d=get_placeholder(a);var b=a.attr("data-url");refresh_attachments(d,b);on_popup_close=function(){refresh_attachments(d,b)}}function insert_break(b){b.preventDefault();var a=$(this);get_matching_elements(a,"textarea").insertAtCaret("\n\n####\n\n")}$(document).ready(function(){$(".main_input_widget_insert_image").click(get_images);$(".main_input_widget_add_attachment").click(get_attachments);$(".main_input_widget_insert_break").click(insert_break);$(".main_input_widget_cancel").click(clear_placeholder)});$(document).ready(function(){$(".kanisaaccountmultipleselector").chosen({placeholder_text_multiple:"Select some users"});$(".kanisaaccountmultipleselector").siblings(".chosen-container").width("100%")});function on_event_type_selection_change(){var a=$(this).find(":selected").text();if($(this).val().length==0){a=""}var b=$("#id_title");var c=b.attr("data-last-automatic-value");if(typeof c!="undefined"&&b.val()!=c){return}b.val(a);b.attr("data-last-automatic-value",a)}function on_event_multi_day_change(){if($(this).is(":checked")){$("#div_id_duration").slideUp();$("#div_id_end_date").slideDown();$("#id_duration").val("")}else{$("#div_id_duration").slideDown();$("#div_id_end_date").slideUp();$("#id_end_date").val("")}}function set_initial_multiday_state(){var a=$("#id_date").val();var b=$("#id_end_date").val();if(a!=b&&b.length>0){$("#id_is_multi_day").attr("checked","checked");$("#div_id_duration").hide()}else{$("#id_is_multi_day").removeAttr("checked");$("#div_id_end_date").hide();$("#id_end_date").val("")}}$(document).ready(function(){$(".scheduledevent #id_event").change(on_event_type_selection_change);$(".scheduledevent #id_is_multi_day").change(on_event_multi_day_change);set_initial_multiday_state()});